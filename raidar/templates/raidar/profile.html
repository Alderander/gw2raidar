{% load staticfiles %}
[[#with profile]]

  [[#with page.era.profile]]

    <div class="uk-button-group uk-width-1-1 boundary uk-margin-bottom uk-margin-top uk-visible@s">
      {# <button class="uk-button">All (45)</button> #}
      <div class="uk-inline">
          [[#with {active: page.area == 'All raid bosses' || page.area in data.areas && (data.areas[page.area].kind == 1 || data.areas[page.area].kind == 2)}]]
            <button class="uk-button" class-uk-button-primary="active">[[#if active]][[data.areas[page.area] ? data.areas[page.area].name : page.area]] &mdash;&nbsp;[[/if]]Raids <i class="material-icons">expand_more</i></button>
          [[/with]]
          <div uk-dropdown="mode: click; boundary: .boundary; boundary-align: true; pos: bottom-justify;">
              <div class="uk-width-1 uk-grid">
                  <div class="uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                        <li on-click="@.set({'page.area': 'All raid bosses'})" class-uk-active="page.area === 'All raid bosses'">
                          <a href="#">All Raids Encounters ([["All raid bosses" in encounter ? encounter["All raid bosses"].archetype.All.profession.All.elite.All.count : 0]])</a>
                        </li>
                      </ul>
                  </div>
                  <div class="uk-width-1-3@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Spirit Vale</li>
                          <li on-click="@.set({'page.area': '15438'})" class-uk-active="page.area === '15438'"><a href="#">[[data.areas[15438].name]] ([[encounter[15438].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '15429'})" class-uk-active="page.area === '15429'"><a href="#">[[data.areas[15429].name]] ([[encounter[15429].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '15375'})" class-uk-active="page.area === '15375'"><a href="#">[[data.areas[15375].name]] ([[encounter[15375].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-3@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Salvation Pass</li>
                          <li on-click="@.set({'page.area': '16123'})" class-uk-active="page.area === '16123'"><a href="#">[[data.areas[16123].name]] ([[encounter[16123].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16088'})" class-uk-active="page.area === '16088'"><a href="#">[[data.areas[16088].name]] ([[encounter[16088].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16115'})" class-uk-active="page.area === '16115'"><a href="#">[[data.areas[16115].name]] ([[encounter[16115].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-3@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Stronghold of the Faithful</li>
                          <li on-click="@.set({'page.area': '16235'})" class-uk-active="page.area === '16235'"><a href="#">[[data.areas[16235].name]] ([[encounter[16235].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16246'})" class-uk-active="page.area === '16246'"><a href="#">[[data.areas[16246].name]] ([[encounter[16246].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-3@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Bastion of the Forgotten</li>
                          <li on-click="@.set({'page.area': '17194'})" class-uk-active="page.area === '17194'"><a href="#">[[data.areas[17194].name]] ([[encounter[17194].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17172'})" class-uk-active="page.area === '17172'"><a href="#">[[data.areas[17172].name]] ([[encounter[17172].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17188'})" class-uk-active="page.area === '17188'"><a href="#">[[data.areas[17188].name]] ([[encounter[17188].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17154'})" class-uk-active="page.area === '17154'"><a href="#">[[data.areas[17154].name]] ([[encounter[17154].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-3@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Hall of Chains</li>
                          <li on-click="@.set({'page.area': '19767'})" class-uk-active="page.area === '19767'"><a href="#">[[data.areas[19767].name]] ([[encounter[19767].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '19450'})" class-uk-active="page.area === '19450'"><a href="#">[[data.areas[19450].name]] ([[encounter[19450].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
      <div class="uk-inline">
          [[#with {active: page.area == 'All fractal bosses' || page.area in data.areas && data.areas[page.area].kind == 4}]]
            <button class="uk-button" class-uk-button-primary="active">[[#if active]][[data.areas[page.area] ? data.areas[page.area].name : page.area]] &mdash;&nbsp;[[/if]]Fractals CM <i class="material-icons">expand_more</i></button>
          [[/with]]
          <div uk-dropdown="mode: click; boundary: .boundary; boundary-align: true; pos: bottom-justify;">
              <div class="uk-width-1 uk-grid">
                  <div class="uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                        <li on-click="@.set({'page.area': 'All fractal bosses'})" class-uk-active="page.area === 'All fractal bosses'">
                          <a href="#">All Fractal CM Encounters ([["All fractal bosses" in encounter ? encounter["All fractal bosses"].archetype.All.profession.All.elite.All.count : 0]])</a>
                        </li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Nightmare</li>
                          <li on-click="@.set({'page.area': '17021'})" class-uk-active="page.area === '17021'"><a href="#">[[data.areas[17021].name]] ([[encounter[17021].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17028'})" class-uk-active="page.area === '17028'"><a href="#">[[data.areas[17028].name]] ([[encounter[17028].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16948'})" class-uk-active="page.area === '16948'"><a href="#">[[data.areas[16948].name]] ([[encounter[16948].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Shattered Observatory</li>
                          <li on-click="@.set({'page.area': '17632'})" class-uk-active="page.area === '17632'"><a href="#">[[data.areas[17632].name]] ([[encounter[17632].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17949'})" class-uk-active="page.area === '17949'"><a href="#">[[data.areas[17949].name]] ([[encounter[17949].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '17759'})" class-uk-active="page.area === '17759'"><a href="#">[[data.areas[17759].name]] ([[encounter[17759].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Twilight Oasis</li>
                          <li on-click="" class-uk-active=""><a href="#"></a></li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
      <div class="uk-inline">
          [[#with {active: page.area == 'All golem bosses' || page.area in data.areas && data.areas[page.area].kind == 3}]]
            <button class="uk-button" class-uk-button-primary="active">[[#if active]][[data.areas[page.area] ? data.areas[page.area].name : page.area]] &mdash;&nbsp;[[/if]]Golems <i class="material-icons">expand_more</i></button>
          [[/with]]
          <div uk-dropdown="mode: click; boundary: .boundary; boundary-align: true; pos: bottom-justify;">
              <div class="uk-width-1 uk-grid">
                  <div class="uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                        <li on-click="@.set({'page.area': 'All golem bosses'})" class-uk-active="page.area === 'All golem bosses'">
                          <a href="#">All Golem Encounters ([["All golem bosses" in encounter ? encounter["All golem bosses"].archetype.All.profession.All.elite.All.count : 0]])</a>
                        </li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Massive</li>
                          <li on-click="@.set({'page.area': '16178'})" class-uk-active="page.area === '16178'"><a href="#">[[data.areas[16178].name]] ([[encounter[16178].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16202'})" class-uk-active="page.area === '16202'"><a href="#">[[data.areas[16202].name]] ([[encounter[16202].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16169'})" class-uk-active="page.area === '16169'"><a href="#">[[data.areas[16169].name]] ([[encounter[16169].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Normal</li>
                          <li on-click="@.set({'page.area': '16199'})" class-uk-active="page.area === '16199'"><a href="#">[[data.areas[16199].name]] ([[encounter[16199].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16177'})" class-uk-active="page.area === '16177'"><a href="#">[[data.areas[16177].name]] ([[encounter[16177].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16198'})" class-uk-active="page.area === '16198'"><a href="#">[[data.areas[16198].name]] ([[encounter[16198].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
                  <div class="uk-width-1-4@m uk-width-1">
                      <ul class="uk-nav uk-dropdown-nav">
                          <li class="uk-nav-header">Special</li>
                          <li on-click="@.set({'page.area': '16176'})" class-uk-active="page.area === '16176'"><a href="#">[[data.areas[16176].name]] ([[encounter[16176].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                          <li on-click="@.set({'page.area': '16174'})" class-uk-active="page.area === '16174'"><a href="#">[[data.areas[16174].name]] ([[encounter[16174].archetype.All.profession.All.elite.All.count || 0]])</a></li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
    </div>
    <div class="uk-button-group uk-width-1-1 uk-hidden@s">
      <button class="uk-button uk-width-expand" on-click="@.set({'page.area': 'All raid bosses'})" class-uk-active="page.area === 'All raid bosses'">Raids</button>
      <button class="uk-button uk-width-expand" on-click="@.set({'page.area': 'All fractal bosses'})" class-uk-active="page.area === 'All fractal bosses'">Fractals</button>
      <button class="uk-button uk-width-expand" on-click="@.set({'page.area': 'All golem bosses'})" class-uk-active="page.area === 'All golem bosses'">Golems</button>
    </div>
    <h6 class="uk-font-family-secondary uk-hidden@s uk-margin-top">Encounter</h6>
    <select class="uk-select uk-hidden@s uk-margin-bottom" name="encounter" id="">
      <option value="">All Raids</option>
      <optgroup label="Spirit Vale">
        <option value="">Vale Guardian</option>
        <option value="">Gorseval</option>
        <option value="">Sabetha</option>
      </optgroup>
      <optgroup label="Salvation Pass">
        <option value="">Slothasor</option>
        <option value="">Bandit Trio</option>
        <option value="">Matthias</option>
      </optgroup>
    </select>

  {% comment %}
    <div class="uk-margin">
      <div uk-grid class="uk-grid-small">
        [[#each keysWithAllLast(encounter, data.areas)]]
          [[#with {encounterId: .}]]
            [[#with encounter[encounterId].archetype.All.profession.All.elite.All]]
              <div uk-tooltip class="uk-padding-small uk-margin-left uk-margin-remove-adjacent link" title="[[avg_success_percentage.toPrecision(3)]]%" style="[[barSurvivalPerc(0, 100 - avg_success_percentage, 0)]]; width: 230px;" on-click="@.set({ 'page.area': encounterId })" class-all="[[encounterId.match(/^All \w+ bosses$/)]]">
                <input class="uk-radio" type="radio" name="[[page.area]]" value="[[encounterId]]"/>
                [[encounterId.match(/^All \w+ bosses$/) ? encounterId : data.areas[encounterId]]]
                ([[count]])
              </div>
            [[/with]]
          [[/with]]
        [[/each]]
      </div>
    </div>
  {% endcomment %}
  <div>
    <h6 class="uk-font-family-secondary">Time Frame</h6>
    <button class="uk-button uk-width-auto@l uk-width-1-1 uk-margin-right@l" type="button">Most recent <i class="material-icons">expand_more</i></button>
    <div uk-dropdown="mode: click">
        <ul class="uk-nav uk-dropdown-nav">
          [[#each eras]]
            <li><a href="[[id]]">[[name]]</a></li>
          [[/each]]
        </ul>
    </div>
  </div>
    [[#if encounter[page.area]]]
    [[#if page.area.match(/^All \w+ bosses$/)]]
    <h2>[[page.area.match(/^All \w+ bosses$/) ? page.area : data.areas[page.area].name]]</h2>
    <span class="uk-badge uk-text-bold uk-label-success uk-margin-small-right">
      Alive [[
        perc(100
        - encounter[page.area].archetype.All.profession.All.elite.All.avg_down_percentage
        - encounter[page.area].archetype.All.profession.All.elite.All.avg_dead_percentage
        )]]
    </span>
    <span class="uk-badge uk-text-bold uk-label-warning uk-margin-small-right">
      Downed [[perc(encounter[page.area].archetype.All.profession.All.elite.All.avg_down_percentage)]]
    </span>
    <span class="uk-badge uk-text-bold uk-label-error">
      Dead [[perc(encounter[page.area].archetype.All.profession.All.elite.All.avg_dead_percentage)]]
    </span>
    [[else]]
    <div class="r-media uk-margin-medium-top">
      <img width="70px" src="/static/raidar/img/icon/[[data.areas[page.area].name]].png" alt="[[data.areas[page.area].name]]">
      <div class="r-body">
        <h2 style="line-height:1;" class="uk-margin-small-bottom">[[page.area.match(/^All \w+ bosses$/) ? page.area : data.areas[page.area].name]]</h2>
        <span class="uk-badge uk-text-bold uk-label-success uk-margin-small-right">
          Alive [[
            perc(100
            - encounter[page.area].archetype.All.profession.All.elite.All.avg_down_percentage
            - encounter[page.area].archetype.All.profession.All.elite.All.avg_dead_percentage
            )]]
        </span>
        <span class="uk-badge uk-text-bold uk-label-warning uk-margin-small-right">
          Downed [[perc(encounter[page.area].archetype.All.profession.All.elite.All.avg_down_percentage)]]
        </span>
        <span class="uk-badge uk-text-bold uk-label-error">
          Dead [[perc(encounter[page.area].archetype.All.profession.All.elite.All.avg_dead_percentage)]]
        </span>
      </div>
    </div>
    [[/if]]

        [[#each keysWithAllLast(encounter[page.area].archetype, {1: 2, 2: 3, 5: 1})]]
          [[#with {archetypeId: ., archetype: encounter[page.area].archetype[.]}]]
          <h2 class="uk-heading-line"><span>[[#if archetypeId !== 'All']]
            <img alt="[[data.archetypes[archetypeId]]]" src="{% static 'raidar/img/arch/' %}/[[data.archetypes[archetypeId]]].png"/>
          [[/if]] [[archetypeId === 'All' ? 'All' : data.archetypes[archetypeId]]]</span></h2>
          <h6 class="uk-font-family-secondary uk-text-uppercase uk-text-regular uk-margin-remove-top">
            Archetype played [[perc(encounter[page.area].archetype[archetypeId] ? 100 * encounter[page.area].archetype[archetypeId].profession.All.elite.All.count / encounter[page.area].archetype.All.profession.All.elite.All.count : 0)]] of encounters.
          </h6>
          <div class="uk-grid">
            [[#each keysWithAllLast(archetype.profession)]]
              [[#with {professionId: ., profession: archetype.profession[.]}]]
                [[#each keysWithAllLast(profession.elite)]]
                  [[#with {eliteId: ., elite: profession.elite[.]}]]
                    [[#with elite]]
                      <div class="uk-width-1-4@xl uk-width-1-3@m uk-width-1-2@s uk-width-1-1">
                        <div class="r-profile-stats">
                          <div class="r-profile-profession">
                            [[#if professionId !== 'All']]
                              <img alt="[[data.specialisations[professionId][eliteId]]]" src="{% static 'raidar/img/48px/' %}/[[data.specialisations[professionId][eliteId]]]_tango_icon_48px.png"/>
                            [[else]]
                              <img alt="All Archetypes" src="/static/raidar/img/48px/Any_tango_icon_48px.png"/>
                            [[/if]]
                            <div>
                              <h4 class="uk-margin-remove">[[professionId === 'All' ? 'All' : data.specialisations[professionId][eliteId]]]</h4>
                              <h6 class="uk-font-family-secondary uk-text-uppercase uk-text-regular uk-margin-remove">Encounters: [[num(.count, 0)]]</h6>
                            </div>
                          </div>
                          <div class="r-profile-activity">
                            <div class="r-tooltip-help" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Downstate</h6>Spent an average of [[perc(.avg_down_percentage)]] of encounter time in down state." uk-tooltip="pos:bottom-left;">
                              <img width="18px" src="/static/raidar/img/icon/Downed_ally.png" alt="Time spent in downed state">
                              <span class="uk-badge uk-background-default">[[perc(.avg_down_percentage)]]</span>
                            </div>
                            <div class="r-tooltip-help" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Dead</h6>Spent an average of [[perc(.avg_dead_percentage)]] of encounter time dead." uk-tooltip="pos:bottom-left;">
                              <img width="18px" src="/static/raidar/img/icon/Downed_enemy.png" alt="Time spent dead">
                              <span class="uk-badge uk-background-default">[[perc(.avg_dead_percentage)]]</span>
                            </div>
                          </div>
                          <div class="r-profile-damage">
                            <h6 class="uk-font-family-secondary uk-text-uppercase uk-text-regular uk-margin-small-bottom">Average DPS</h6>
                            <svg class="chart" xmlns='http://www.w3.org/2000/svg' height="24px" width="100%">
                              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total</h6>[[num(.avg_dps, 0)]] Damage Per Second. <br /> Click for detailed graph." x='0%' y='0' height='8px' width='100%' opacity='0.6' on-click="@this.fire('chart', event, archetypeId, professionId, eliteId, 'dps', 'DPS')" />
                              <!--
                              Second <rect> is full opacity and the same color.

                              -->
                              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss</h6>[[num(.avg_dps_boss, 0)]] Damage Per Second. <br /> Click for detailed graph." x='0%' y='0' height='8px' width='85%' on-click="@this.fire('chart', event, archetypeId, professionId, eliteId, 'dps_boss', 'Boss DPS')"/>
                              <!--
                              Text with some custom adjustments to deal with alignment issues.
                              -->
                              <text x='100%' y='12px' alignment-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>([[num(.avg_dps_boss, 0)]]) [[num(.avg_dps, 0)]]</text>

                            </svg>
                            <h6 class="uk-font-family-secondary uk-text-uppercase uk-text-regular uk-margin-remove-top uk-margin-small-bottom">Max DPS</h6>
                            <svg class="chart" xmlns='http://www.w3.org/2000/svg' height="24px" width="100%">
                              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total</h6>[[num(.max_dps, 0)]] Damage Per Second. <br /> Click for detailed graph." x='0%' y='0' height='8px' width='100%' opacity='0.6' on-click="@this.fire('chart', event, archetypeId, professionId, eliteId, 'dps', 'DPS')" />
                              <!--
                              Second <rect> is full opacity and the same color.

                              -->
                              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h6 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss</h6>[[num(.max_dps_boss, 0)]] Damage Per Second. <br /> Click for detailed graph." x='0%' y='0' height='8px' width='85%' on-click="@this.fire('chart', event, archetypeId, professionId, eliteId, 'dps_boss', 'Boss DPS')"/>
                              <!--
                              Text with some custom adjustments to deal with alignment issues.
                              -->
                              <text x='100%' y='12px' alignment-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>([[num(.max_dps, 0)]]) [[num(.max_dps_boss, 0)]]</text>
                            </svg>
                          </div>
                        </div>
                      </div>
                      [[/with]]
                    [[/with]]
                  [[/each]]
                [[/with]]
              [[/each]]
            </div>
          [[/with]]
        [[/each]]
    [[/if]]
  [[/with]]
[[/with]]
