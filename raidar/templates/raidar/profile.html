[[#with profile]]
  <div class="uk-clearfix">
    <div class="uk-float-left">
      <h2 class="uk-margin-remove">Profile: <strong>[[username]]</strong></h2>
      <div>
        <span class="ignore">Member since</span> [[formatDate(joined_at)]]
      </div>
      <div>
        <span class="ignore">Played through</span>
        [[count]]
        <span class="ignore">encounters in</span>
        <span>[[era.name]]</span>
        <div uk-dropdown>
          <h4>[[era.name]] Era</h4>
          <div>Started at: [[formatDate(era.started_at)]]</div>
          <div>[[era.description]]</div>
        </div>
        <span class="ignore">era</span>
      </div>
    </div>

    <div class="uk-float-right uk-text-center">
      <div class="uk-flex uk-flex-between uk-padding-small" style="[[barSurvivalPerc(summary.avg_down_percentage, summary.avg_dead_percentage, summary.avg_disconnect_percentage)]]; width: 400px">
        <div>Down [[(100 * summary.avg_down_percentage).toPrecision(3)]]%</div>
        <div>Dead [[(100 * summary.avg_dead_percentage).toPrecision(3)]]%</div>
        <div>Disc [[(100 * summary.avg_disconnect_percentage).toPrecision(3)]]%</div>
      </div>
      <div class="uk-flex uk-flex-between uk-padding-small" style="[[barSurvivalPerc(
          100 * encounter.All.archetype[1].profession.All.count / encounter.All.archetype.All.profession.All.count,
          100 * encounter.All.archetype[2].profession.All.count / encounter.All.archetype.All.profession.All.count,
          0
        )]]; width: 400px">
        <div>Support [[(100 * encounter.All.archetype[5].profession.All.count / encounter.All.archetype.All.profession.All.count).toPrecision(3)]]%</div>
        <div>Power [[(100 * encounter.All.archetype[1].profession.All.count / encounter.All.archetype.All.profession.All.count).toPrecision(3)]]%</div>
        <div>Condi [[(100 * encounter.All.archetype[2].profession.All.count / encounter.All.archetype.All.profession.All.count).toPrecision(3)]]%</div>
      </div>
    </div>
  </div>


  <div class="uk-container uk-margin">
    <div uk-grid class="uk-grid-small">
      [[#each encounter:encounterId]]
        [[#with archetype.All.profession.All]]
          <div uk-tooltip class="uk-padding-small uk-margin-left uk-margin-remove-adjacent" title="[[avg_success_percentage.toPrecision(3)]]%" style="[[barSurvivalPerc(0, 100 - avg_success_percentage, 0)]]; width: 230px;" on-click="@.set({ 'page.area': encounterId })">
            <input class="uk-radio" type="radio" name="[[page.area]]" value="[[encounterId]]"/>
            [[encounterId == 'All' ? 'All' : data.areas[encounterId]]]
            ([[count]])
          </div>
        [[/with]]
      [[/each]]
    </div>
  </div>


  [[#each encounter[page.area].archetype:archetypeId]]
  <h3>
    [[archetypeId == 'All' ? 'All' : data.archetypes[archetypeId]]]
    <span class="ignore">Archetypes on</span>
    [[page.area == 'All' ? 'All Encounters' : data.areas[page.area]]]
  </h3>
    <table class="uk-table uk-table-striped">
      <thead>
        <tr>
          <th>Profession</th>
          <th>Encounters</th>
          <th>Avg DPS</th>
          <th>Max DPS</th>
          <th>Down</th>
          <th>Dead</th>
        </tr>
      </thead>
      <tbody>
        [[#each profession:professionId]]
          <tr>
            <th>
              [[professionId == 'All' ? 'All' : data.specialisations[professionId][0]]]
            </th>
            <td>
              [[count]]
            </td>
            <td>
              [[avg_dps !== undefined ? Math.round(avg_dps) : '']]
            </td>
            <td>
              [[max_dps !== undefined ? Math.round(max_dps) : '']]
            </td>
            <td>
              [[avg_down_percentage !== undefined ? avg_down_percentage.toPrecision(3) + '%' : '']]
            </td>
            <td>
              [[avg_dead_percentage !== undefined ? avg_dead_percentage.toPrecision(3) + '%' : '']]
            </td>
          </tr>
        [[/each]]
      </tbody>
    </table>
  [[/each]]
[[/with]]
