{% load staticfiles %}

[[#with global_stats]]
  <div id="content">
    {% include 'raidar/encounter_filter.html' %}
    <!-- <select as-ukUpdate id="era-selector" class="uk-select uk-width-auto" value='[[page.era_id]]'
            on-change="refresh_page">
        <option value="[[null]]">Most recent</option>
      [[#each eras]]
        <option value='[[id]]'>[[name]]</option>
      [[/each]]
    </select> -->
    <!-- Era Filter -->
    [[#with stats]]
    <div class="uk-flex-left" uk-grid>
      <div>
        <h6 class="uk-font-family-secondary">Time Frame</h6>
        <button class="uk-button uk-width-auto@l uk-width-1-1 uk-margin-right@l" type="button">Most recent <i class="material-icons">expand_more</i></button>
        <div uk-dropdown="mode: click">
            <ul class="uk-nav uk-dropdown-nav">
              [[#each eras]]
                <li><a href="[[id]]">[[name]]</a></li>
              [[/each]]
            </ul>
        </div>
      </div>
      <div>
        <h6 class="uk-font-family-secondary">Compare Percentile</h6>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="99check" checked>
        <label class="r-percentile-label uk-text-bold" for="99check"><span class="uk-badge r-bg-99">99%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="90check" checked>
        <label class="r-percentile-label uk-text-bold" for="90check"><span class="uk-badge r-bg-90">90%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="80check">
        <label class="r-percentile-label uk-text-bold" for="80check"><span class="uk-badge r-bg-80">80%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="70check">
        <label class="r-percentile-label uk-text-bold" for="70check"><span class="uk-badge r-bg-70">70%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="60check">
        <label class="r-percentile-label uk-text-bold" for="60check"><span class="uk-badge r-bg-60">60%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="50check" checked>
        <label class="r-percentile-label uk-text-bold" for="50check"><span class="uk-badge r-bg-50">50%</span></label>
        <input class="uk-checkbox r-percentile-checkbox" type="checkbox" id="30check">
        <label class="r-percentile-label uk-text-bold" for="30check"><span class="uk-badge r-bg-30">30%</span></label>
      </div>
    </div>





  <div class="uk-clearfix">

    <!-- <div class="uk-float-right uk-text-right">
      <select as-ukUpdate id="area-selector" class="uk-select" value='[[page.area_id]]'
              on-change="refresh_page">
          <option value="[[null]]">All</option>
        [[#each areas]]
          <option value='[[id]]'>[[name]]</option>
        [[/each]]
      </select>

    </div> -->

  </div>
      <!-- <p><strong>Disclaimer: The statistics displayed in this report are based off data available within GW2Raidar only, as such it is not a complete representation of the Guild Wars 2 raiding community. Efforts are made to ensure accuracy, however some anomalies may exist. Only successful runs are included and builds with fewer than 10 data points are not shown.</strong></p> -->


      <!-- Grid CSS experiement -->
      <h2 class="uk-heading-line"><span>Full Group</span></h2>
      <div class="r-global-stats-container r-global-group-stats-container">
        <div class="r-stats-row r-stats-header uk-visible@l">
          <div>Duration</div>
          <div>DPS</div>
          <div>DPS Recieved</div>
        </div>
        <div class="r-stats-row">
          <div class="r-duration">
            <div class="r-duration-item r-bg-99">5:35
            </div>
            <div class="r-duration-item  r-bg-90">6:02
            </div>
            <div class="r-duration-item  r-bg-50">8:32
            </div>
          </div>
          <div class="r-global-stats-damage">
            <svg class="chart" xmlns='http://www.w3.org/2000/svg' height="60px" width="100%">
              <!--
              Overlapping charts for Boss and Cleave damage

              First <rect> is the "cleave" damage which as a slight opactity drop to the color. Each are positioned exactly at the same X,Y values but different dynamic widths based on data.

              Classes assign colors: r-bg-{Percentile} will add the color to that element.

              -->
              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total | 99th Percentile</h6>36432 Damage Per Second" x='0%' y='14px' height='8px' width='100%' opacity='0.3' />
              <!--
              Second <rect> is full opacity and the same color.

              -->
              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 99th Percentile</h6>32305 Damage Per Second" x='0%' y='14px' height='8px' width='85%'/>

              <!-- 90th percentile -->
              <rect class="chart chart-hover r-bg-90" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total | 90th Percentile</h6>32721 Damage Per Second" x='0%' y='26px' height='8px' width='65%' opacity='0.3'/>
              <rect class="chart chart-hover r-bg-90" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 90th Percentile</h6>30000 Damage Per Second" x='0%' y='26px' height='8px' width='55.9176428058626%'/>

              <!-- 50th percentile -->
              <rect class="chart chart-hover r-bg-50" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total | 50th Percentile</h6>22352 Damage Per Second" x='0%' y='38px' height='8px' width='48.44386649328132%' opacity="0.6"/>
              <rect class="chart chart-hover r-bg-50" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 50th Percentile</h6>21032 Damage Per Second" x='0%' y='38px' height='8px' width='39.44386649328132%'/>

              <!--
              Text with some custom adjustments to deal with alignment issues.
              -->
              <text x='100%' y='0' alignment-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>(Boss DMG) Cleave DMG</text>

              <!-- This middle one might be a little funny. It's x value needs to be about 4px more than the rect element it references. -->
              <text x='65.5%' y='30px' alignment-baseline="middle" text-anchor="start" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>(Boss DMG) Cleave DMG</text>

              <text x='48.44386649328132%' y='48px' alignment-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>(Boss DMG) Cleave DMG</text>
            </svg>
          </div>
          <div class="r-global-stats-damageIn">
            <svg class="chart" xmlns='http://www.w3.org/2000/svg' height="40px" width="100%">
              <rect class="chart chart-hover r-bg-99" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 99th Percentile</h6>32305 Damage Per Second" x='0%' y='4px' height='8px' width='48%'/>
              <rect class="chart chart-hover r-bg-90" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 90th Percentile</h6>30000 Damage Per Second" x='0%' y='16px' height='8px' width='65%'/>
              <rect class="chart chart-hover r-bg-50" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | 50th Percentile</h6>21032 Damage Per Second" x='0%' y='28px' height='8px' width='100%'/>
              <!--
              Text with some custom adjustments to deal with alignment issues.
              -->
              <text x='48%' y='0' alignment-baseline="baseline" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>22352</text>
              <!-- This middle one might be a little funny. It's x value needs to be about 4px more than the rect element it references. -->
              <text x='65.5%' y='20px' alignment-baseline="middle" text-anchor="start" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>32721</text>
              <text x='100%' y='38px' alignment-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>36201</text></svg>
          </div>
        </div>
      </div>

      [[#each [{archetype: 1}, {archetype: 2}, {archetype: 5}] ]]
      <h2 class="uk-heading-line"><span>[[data.archetypes[archetype]]]</span></h2>

      <div class="r-global-stats-container">
        <div class="r-stats-row r-stats-header uk-visible@l">
          <div></div>
          <div>Damage Per Second</div>
          <div>Buffs</div>
        </div>

        [[#each flattenStats(build)]]
          [[#with {lineStats: build[professionId][eliteId][archetypeId]}]]
            [[#if professionId != 'All' && eliteId != 'All' && archetypeId == archetype]]
              [[#with {buffs: highestBuffs(build[professionId][eliteId][archetypeId].buffs_out)}]]
                <div class="r-stats-row">
                  <div class='r-spec'>
                    <div>
                      <h6 class="uk-font-family-secondary uk-text-uppercase uk-margin-remove">[[data.specialisations[professionId][0]]]</h6>
                      [[#if true]]
                      <h5 class="uk-margin-remove" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Medium Confidence Level</h6> Statistics that combine multiple encounters may be heavily skewed by the fact that different classes are used at different bosses, regardless of sample size ([[lineStats.count]])"><i class="material-icons uk-text-warning uk-text-small r-global-stats-indicator">info</i>[[data.specialisations[professionId][eliteId]]]</h5>
                      [[elseif lineStats.count >= 40]]
                      <h5 class="uk-margin-remove" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>High Confidence Level</h6> This indicates a large sample size ([[lineStats.count]]) and the statistics shown should be an accurate representation."><i class="material-icons uk-text-success uk-text-small r-global-stats-indicator">stars</i> [[data.specialisations[professionId][eliteId]]]</h5>
                      [[elseif lineStats.count >= 20]]
                      <h5 class="uk-margin-remove" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Medium Confidence Level</h6> This indicates a moderate sample size ([[lineStats.count]]) and the statistics are probably a good representation but could contain some outliers that are skewing numbers up or down."><i class="material-icons uk-text-warning uk-text-small r-global-stats-indicator">info</i>[[data.specialisations[professionId][eliteId]]]</h5>
                      [[else]]
                      <h5 class="uk-margin-remove" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Low Confidence Level</h6> This indicates a small sample size ([[lineStats.count]]) there is enough data to be shown (more than 10 logs) but it's probably heavily skewed by outliers."><i class="material-icons uk-text-danger uk-text-small r-global-stats-indicator">cancel</i>[[data.specialisations[professionId][eliteId]]]</h5>
                      [[/if]]
                    </div>
                    <img alt="[[data.specialisations[professionId][eliteId]]]" src="/static/raidar/img/48px/[[data.specialisations[professionId][eliteId]]]_tango_icon_48px.png">
                  </div>
                  <div class="r-global-stats-damage">
                    <h6 class="uk-font-family-secondary uk-text-uppercase uk-hidden@l">Damage Per Second</h6>
                    <svg class="chart" xmlns='http://www.w3.org/2000/svg' height="60px" width="100%">
                      [[#with {dps_percentiles:p(lineStats.per_dps)}]]
                      [[#each [{"v":99},{"v":90},{"v":50}]]]

                        <!--
                      Overlapping charts for Boss and Cleave damage

                      First <rect> is the "cleave" damage which as a slight opactity drop to the color. Each are positioned exactly at the same X,Y values but different dynamic widths based on data.

                      Classes assign colors: r-bg-{Percentile} will add the color to that element.
                      -->
                        <rect class="chart chart-hover r-bg-[[v]]" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Total | [[v]]th Percentile</h6>[[num(dps_percentiles[v],0)]] Damage Per Second" x='0%' y='[[14 + @index * 12]]px' height='8px' width='[[100*dps_percentiles[v]/individual.max_dps]]%' opacity='0.3' />
                      <!--
                      Second <rect> is full opacity and the same color.
                      -->
                      <rect class="chart chart-hover r-bg-[[v]]" uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>Boss | [[v]]th Percentile</h6>[[num(boss_dps_percentiles[v],0)]] Damage Per Second" x='0%' y='[[14 + @index * 12]]px' height='8px' width='[[100*boss_dps_percentiles[v]/individual.max_dps]]%'/>

                      <!--
                      Text with some custom adjustments to deal with alignment issues.
                      -->
                      [[#if @index == 0]]
                      <text x='[[100*dps_percentiles[v]/individual.max_dps]]%' y='0' dominant-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>([[num(boss_dps_percentiles[v],0)]]) [[num(dps_percentiles[v],0)]]</text>
                      [[elseif @index == 1]]
                      <text x='[[100*dps_percentiles[v]/individual.max_dps]]%' y='30px' dominant-baseline="middle" text-anchor="start" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>([[num(boss_dps_percentiles[v],0)]]) [[num(dps_percentiles[v],0)]]</text>
                      [[else]]
                      <text x='[[100*dps_percentiles[v]/individual.max_dps]]%' y='48px' dominant-baseline="hanging" text-anchor="end" font-family='Source Sans Pro' fill='#FCF1E2'  font-size='11'>([[num(boss_dps_percentiles[v],0)]]) [[num(dps_percentiles[v],0)]]</text>
                      [[/if]]
                      [[/each]]
                      [[/with]]
                    </svg>
                  </div>
                  <div class="r-global-stats-buffs r-buff-container">
                    <h6 class="uk-font-family-secondary uk-text-uppercase uk-hidden@l uk-margin-remove">Buffs</h6>
                    [[#each [
                      buffs[0],
                      buffs[1],
                      buffs[2] ,
                      buffs[3],
                      buffs[4]
                    ] ]]
                    <div class="r-buff">
                      [[#if percentiles]]
                      [[#with {stackable:buff_name == 'might', pretty_name: buff_name.replace('_',' ')}]]
                      <div class="r-buff-icon">
                        <img src="{% static 'raidar/img/buff/' %}/[[buff_image]].png" alt="[[buff_name]]">
                      </div>
                      [[#each [{"v":99},{"v":90},{"v":50}]]]
                        [[#if stackable]]
                        <div uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>[[pretty_name]] Stacks | [[v]]th Percentile</h6>Average output of [[num(percentiles[v], 0)]] stacks of [[pretty_name]]" class="r-buff-number chart-hover r-bg-[[v]]">[[num(percentiles[v], 0)]]
                        </div>
                        [[else]]
                        <div uk-tooltip="pos: bottom-left; delay: 350" title="<h5 class='uk-font-family-secondary uk-text-uppercase uk-margin-remove-bottom'>[[pretty_name]] Uptime | [[v]]th Percentile</h6>Average output of [[num(percentiles[v], 0)]]% [[pretty_name]] uptime" class="r-buff-number r-bg-[[v]] chart-hover">[[num(percentiles[v], 0)]]<sup>%</sup>
                      </div>
                        [[/if]]
                      [[/each]]
                      [[/with]]
                      [[else]]
                      [[/if]]
                    </div>
                    [[/each]]
                  </div>
                </div>
              [[/with]]
            [[/if]]
          [[/with]]
        [[else]]
          <div class="r-stats-row">
            <div class='r-global-stats-damage'>Not enough data to display for [[data.archetypes[archetype]]] specialisations</div>
          </div>
        [[/each]]
      </div>
      [[/each]]
    [[/with]]
  </div>
[[/with]]
