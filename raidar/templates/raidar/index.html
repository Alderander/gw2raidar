{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>GW2 Raidar</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/ractive/0.9.0-build-91/ractive.min.js"
      integrity="sha256-O4lYBK7KHXxgNrZrOj5o4kcDy097G4r/1tC78bUjWLs="
      crossorigin="anonymous"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.16/css/uikit.min.css"
      integrity="sha256-Y26f+YUup4fXzkyNHh6TYAc5jwy5abdgKSx3NBNE0AQ="
      crossorigin="anonymous" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.16/js/uikit.min.js"
      integrity="sha256-HM5Ln23ZwUKUp2XJmTYmSVWc7Ymwdbt8YyQX/k3fsY4="
      crossorigin="anonymous"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.16/js/uikit-icons.min.js"
      integrity="sha256-IwFu/0hq7CewRpF0Uw1qW08A8M6/c72km5+VAegaWX8="
      crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link href="{% static 'raidar/style.css' %}" rel="stylesheet">
    <script>
      window.baseURL = "{% url 'index' %}";
      window.raidar_data = {{ userprops|safe }};

      if (window.raidar_data.ga_property_id) {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', window.raidar_data.ga_property_id, 'auto');
        ga('send', 'pageview');
      }
    </script>


    <script id="template" type="text/ractive">
      <div class="uk-container uk-height-viewport uk-flex uk-flex-column">
        {# Logo #}
        <header class="uk-grid">
          <div class="uk-width-1-1">
            <h1 class="uk-heading-large uk-padding-small uk-light uk-background-primary">GW2 Raidar</h1>
          </div>
        </header>

        {% include 'raidar/navbar.html' %}

        {# content #}
        <div class="uk-flex-1">
          [[#if username]]

            [[#if loading]]

            <center class="uk-margin-large-top">
              <div uk-spinner></div>
            </center>

            [[elseif page.name == "encounters"]]

              [[#if encounters.length]]
                {% include 'raidar/encounters.html' %}
              [[else]]
                <p>
                  Drag and drop evtc files to this window to upload.
                </p>
              [[/if]]

            [[elseif page.name == "profile"]]

              TODO profile - all GW2 accounts, characters with stats

            [[elseif page.name == "account"]]

              <div class="uk-padding">
                <form class="uk-grid uk-grid-small" on-submit="change_password">
                  <div class="uk-width-1-4">
                    <input class="uk-input" type="password" placeholder="Old password" value="[[account.old_password]]"/>
                  </div>
                  <div class="uk-width-1-4">
                    <input class="uk-input" type="password" placeholder="Change password" value="[[account.password]]"/>
                  </div>
                  <div class="uk-width-1-4">
                    <input class="uk-input" type="password" placeholder="Confirm password" value="[[account.password2]]"/>
                  </div>
                  <div class="uk-width-1-4">
                    <button class="uk-button uk-button-primary uk-width-1-1" disabled="[[changePassBad]]">Save</button>
                  </div>
                </form>

                <form class="uk-grid uk-grid-small" on-submit="change_email">
                  <div class="uk-width-3-4">
                    <input class="uk-input" type="email" placeholder="Change email address" value="[[account.email]]"/>
                  </div>
                  <div class="uk-width-1-4">
                    <button class="uk-button uk-button-primary uk-width-1-1" disabled="[[account.email.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/) == null]]">Save</button>
                  </div>
                </form>

                <form class="uk-grid uk-grid-small" on-submit="add_api_key">
                  <div class="uk-width-3-4">
                    <input class="uk-input" placeholder="Enter new GW2 API key" value="[[account.api_key]]"/>
                  </div>
                  <div class="uk-width-1-4">
                    <button class="uk-button uk-button-primary uk-width-1-1" disabled="[[account.api_key.match(/^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{20}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$/) == null]]" on-click="add_api_key">Save</button>
                  </div>
                </form>
              </div>

            [[elseif page.name == "encounter"]]

              {% include 'raidar/encounter.html' %}

            [[/if]]

          [[else]]{# username #}

            [[#if page.name == "login"]]

              <form class="uk-form-stacked uk-padding-large uk-text-center">
                <div class="uk-margin">
                  <input id="login_username" class="uk-input uk-form-width-medium" value="[[auth.input.username]]" placeholder="Username">
                </div>
                <div class="uk-margin">
                  <input id="login_password" class="uk-input uk-form-width-medium" value="[[auth.input.password]]" placeholder="Password" type="password">
                </div>
                <div class="uk-margin">
                  <button id="login_submit" class="uk-button uk-button-default" on-click="auth_login" disabled="[[authBad]]">Login</button><br>
                </div>
              </form>

            [[elseif page.name == "register"]]

              <form class="uk-form-stacked uk-padding-large uk-text-center">
                <div class="uk-margin">
                  <input id="register_username" class="uk-input uk-form-width-medium" value="[[auth.input.username]]" placeholder="Username">
                </div>
                <div class="uk-margin">
                  <input id="register_email" class="uk-input uk-form-width-medium" value="[[auth.input.email]]" placeholder="Email">
                </div>
                <div class="uk-margin">
                  <input id="register_password" class="uk-input uk-form-width-medium" value="[[auth.input.password]]" placeholder="Password" type="password">
                </div>
                <div class="uk-margin">
                  <input id="register_password2" class="uk-input uk-form-width-medium" value="[[auth.input.password2]]" placeholder="Again" type="password">
                </div>
                <div class="uk-margin">
                  <div class="uk-inline">
                    <a class="uk-form-icon uk-form-icon-flip" href="https://account.arena.net/applications" uk-icon="icon: link" target="gw2apps"></a>
                    <input id="register_api_key" class="uk-input uk-form-width-medium" value="[[auth.input.api_key]]" placeholder="GW2 API key" autocomplete="off">
                  </div>
                </div>
                <div class="uk-margin">
                  <button id="register_submit" class="uk-button uk-button-default" on-click="auth_register" disabled="[[authBad]]">Register</button><br>
                </div>
              </form>

            [[elseif page.name == "reset_pw"]]

              <form class="uk-form-stacked uk-padding-large uk-text-center">
                <div class="uk-margin">
                  <input id="reset_pw_email" class="uk-input uk-form-width-medium" value="[[auth.input.email]]" placeholder="Email">
                </div>
                <div class="uk-margin">
                  <button id="reset_pw_submit" class="uk-button uk-button-default" on-click="auth_reset_pw" disabled="[[authBad]]">Reset password</button><br>
                </div>
              </form>

            [[else]]

              TODO
              {#% include 'raidar/intro.html' %#}

            [[/if]]

          [[/if]]{# username #}
        </div>

        <footer class="uk-heading uk-padding-small uk-light uk-background-secondary">
          <div class="uk-float-right states">
            [[#each {1: "Uploading", 2: "Analysing", 3: "Uploaded", 4: "Rejected"}:state]]
              [[#if uploadsByState[state]]]
                <span class="uk-badge [[.toLowerCase()]]">
                  [[uploadsByState[state].length]]
                </span>
                <div uk-drop="pos: top-right">
                  <dl class="uk-card uk-card-body uk-card-default">
                    <dt>[[.]]:</dt>
                    <dd>
                      [[#each uploadsByState[state]]]
                        [[.]]<br>
                      [[/each]]
                    </dd>
                  </dl>
                </div>
              [[/if]]
            [[/each]]
          </div>
          Footer
        </footer>
      </div>
    </script>
  </head>
  <body class="uk-height-viewport">
    {% csrf_token %}
    <div id="container" class="uk-container uk-height-viewport">
    </div>
    <script src="{% static 'raidar/script.js' %}"></script>
  </body>
</html>
